<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>alias docker=podman -</title><meta name=description content="all it requires?"><meta name=author content="Job CÃ©spedes Ortiz"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"My Dev Blog","url":"https:\/\/jobcespedes.dev\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/jobcespedes.dev\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/jobcespedes.dev\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/jobcespedes.dev\/2020\/03\/alias-docker-podman\/","name":"Alias docker podman"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Job CÃ©spedes Ortiz"},"headline":"alias docker=podman","description":"I have heard about podman (Pod Manager tool) more and more often now. Whether it is that I have come closer to its developing environment or that it has come to mine, I\u0026rsquo;m not sure. It\u0026rsquo;s both, I guess. I use Ansible a lot for automating baremetal and virtual infrastructure: for its definition, deployment, configuration, operation, among other things. In the recent years, I have being using more and more containers, particularly in the developing stages.","inLanguage":"en","wordCount":801,"datePublished":"2020-03-02T10:48:50","dateModified":"2020-03-02T10:48:50","image":"https:\/\/jobcespedes.dev\/img\/me_avatar.png","keywords":["containers, podman, unionfs, docker, ansible, bind-propagation, user-namespaces, genesis-1:26"],"mainEntityOfPage":"https:\/\/jobcespedes.dev\/2020\/03\/alias-docker-podman\/","publisher":{"@type":"Organization","name":"https:\/\/jobcespedes.dev\/","logo":{"@type":"ImageObject","url":"https:\/\/jobcespedes.dev\/img\/me_avatar.png","height":60,"width":60}}}</script><meta property="og:title" content="alias docker=podman"><meta property="og:description" content="all it requires?"><meta property="og:image" content="https://jobcespedes.dev/img/me_avatar.png"><meta property="og:url" content="https://jobcespedes.dev/2020/03/alias-docker-podman/"><meta property="og:type" content="website"><meta property="og:site_name" content="My Dev Blog"><meta name=twitter:title content="alias docker=podman"><meta name=twitter:description content="all it requires?"><meta name=twitter:image content="https://jobcespedes.dev/img/me_avatar.png"><meta name=twitter:card content="summary_large_image"><link href=https://jobcespedes.dev/img/me.ico rel=icon type=image/x-icon><meta name=generator content="Hugo 0.94.1"><link rel=alternate href=https://jobcespedes.dev/index.xml type=application/rss+xml title="My Dev Blog"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css integrity=sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><link rel=stylesheet href=https://jobcespedes.dev/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://jobcespedes.dev/css/highlight.min.css><link rel=stylesheet href=https://jobcespedes.dev/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-159956456-1","auto"),ga("send","pageview"))</script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=https://jobcespedes.dev/>My Dev Blog</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"></ul></div><div class=avatar-container><div class=avatar-img-border><a title="My Dev Blog" href=https://jobcespedes.dev/><img class=avatar-img src=https://jobcespedes.dev/img/me_avatar.png alt="My Dev Blog"></a></div></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=posts-heading><h1>alias docker=podman</h1><hr class=small><h2 class=posts-subheading>all it requires?</h2></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>I have heard about <a href=https://podman.io/>podman</a> (Pod Manager tool) more and more often now. Whether it is that I have come closer to its developing environment or that it has come to mine, I&rsquo;m not sure. It&rsquo;s both, I guess. I use Ansible a lot for automating baremetal and virtual infrastructure: for its definition, deployment, configuration, operation, among other things. In the recent years, I have being using more and more containers, particularly in the developing stages. And I really like open source, most of its concepts, and many initiatives around it. So, I have being wondering if I should be using mainly podman for containers already. There is, however, this one recurrent question in my head:</p><blockquote><p>How much work will adapting those docker projects take?</p></blockquote><h2 id=why-that-unionfs-container>Why that unionfs container?</h2><p>I use Ansible a lot for automating infrastructure. It works well for having multiple stages/environments over that infrastructure. However, managing those multiple stage/environment directories sometimes become kind of messy. <a href=https://github.com/jobcespedes/demo-multienv>Demo-multienv</a> looks for a way to avoid it. It uses unionfs inside a container to stack directories/files, reducing data and file duplication among them. You only need docker and its python library installed and Ansible will do it for you. But, could it be run with podman instead?</p><p>It was just docker. I wanted to add compatibility with podman also. I was hoping it would be little extra work, something very simple, just like <code>alias docker=podman</code> for cli. But it required more than that.</p><h2 id=ansible-and-podman>Ansible and podman</h2><p>Docker has <code>docker_container</code> and I was kind of hoping to just change it to <code>podman_container</code> and <em>mission accomplished</em>. But I found that there is no such module included with Ansible, yet. There is <a href=https://github.com/ansible/ansible/issues/46362>WIP</a> for one, though. And, there is available a <a href=https://github.com/openstack/tripleo-ansible/blob/master/tripleo_ansible/ansible_plugins/modules/podman_container.py>Tripleo module</a>. That is the one I tried. It has some different parameter names but its usage is similar overall. It worked perfect in this particular case. The playbook ran successfully.</p><h2 id=the-unexpected>The unexpected</h2><p>Then, it came something unexpected. Files supposed to be exposed from the container to the host, were not there and neither was the mount point. The container successfully started. However, there were no files in the union host&rsquo;s directory. In the container, the files were there and a mount point for the <em>unionfs</em> as well.</p><p>By this point, I was running podman manually (not using Ansible and <a href=https://github.com/jobcespedes/demo-multienv>demo-multienv</a>). Debug option for Ansible and <a href=https://github.com/openstack/tripleo-ansible/blob/master/tripleo_ansible/ansible_plugins/modules/podman_container.py>Tripleo module</a> helped me here. It shows the podman command being used. I copy-pasted it and added a debug level, using: <code>podman --log-level=debug run</code>. There were no errors. It just had a warning:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zed data-lang=zed><span class=line><span class=cl><span class=n>WARN</span><span class=p>[</span><span class=err>0000</span><span class=p>]</span><span class=w> </span><span class=n>Failed</span><span class=w> </span><span class=n>to</span><span class=w> </span><span class=n>add</span><span class=w> </span><span class=n>conmon</span><span class=w> </span><span class=n>to</span><span class=w> </span><span class=n>cgroupfs</span><span class=w> </span><span class=n>sandbox</span><span class=w> </span><span class=n>cgroup</span><span class=o>:</span><span class=w> </span><span class=n>error</span><span class=w> </span><span class=n>creating</span><span class=w> </span><span class=n>cgroup</span><span class=w> </span><span class=n>for</span><span class=w> </span><span class=n>cpu</span><span class=o>:</span><span class=w> </span><span class=n>mkdir</span><span class=w> </span><span class=o>/</span><span class=nn>sys/fs/cgroup/cpu/</span><span class=n>libpod_parent</span><span class=o>:</span><span class=w> </span><span class=kd>permission</span><span class=w> </span><span class=n>denied</span><span class=w>
</span></span></span></code></pre></div><p>However, I could not related it with my problem. <code>podman logs</code> did not show anything wrong. I was clueless, honestly. I just knew that with docker it worked ðŸ˜œ</p><h2 id=community-to-the-rescue>Community to the rescue</h2><p>I turned to the community, opening <a href=https://github.com/containers/libpod/issues/5322>#5322</a> &ndash;after checking previous related issues/discussions of course ðŸ˜„&ndash;. That was how I got to the cause of the problem and learned about other important concept around podman. One particular answer sums it up:</p><blockquote><p>&ldquo;this is not a bug. Rootless containers cannot create mounts in the host.</p><p>The shared mount is created inside of the rootless mount namespace, you can reach it with podman unshare&rdquo; &ndash; @giuseppe. From <a href=https://github.com/containers/libpod/issues/5322#issuecomment-591055081>Github</a></p></blockquote><p>Everywhere in podman documentation, it says it is able to run rootless. And still, I forget that aspect ðŸ˜…. In docker, it was running as root. For it to work in podman:</p><ul><li><strong>It should be run as root</strong></li></ul><p>However, podman still allows one option for running it rootless. It is related to <a href=https://opensource.com/article/18/12/podman-and-user-namespaces><em>user namespaces</em></a> and <a href=https://github.com/containers/libpod/blob/master/docs/source/markdown/podman-unshare.1.md><em>podman unshare</em></a>.</p><ul><li><strong>If rootless, it could be accessed using <code>podman unshare</code></strong></li></ul><p>For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># rootless</span>
</span></span><span class=line><span class=cl><span class=c1>## prepare dir layout</span>
</span></span><span class=line><span class=cl><span class=nv>parent</span><span class=o>=</span><span class=si>${</span><span class=nv>HOME</span><span class=si>}</span>/multienv
</span></span><span class=line><span class=cl><span class=nv>dir1</span><span class=o>=</span><span class=si>${</span><span class=nv>parent</span><span class=si>}</span>/dir1
</span></span><span class=line><span class=cl><span class=nv>dir2</span><span class=o>=</span><span class=si>${</span><span class=nv>parent</span><span class=si>}</span>/dir2
</span></span><span class=line><span class=cl><span class=nv>unionfs</span><span class=o>=</span><span class=si>${</span><span class=nv>parent</span><span class=si>}</span>/multienv/unionfs
</span></span><span class=line><span class=cl>mkdir -p <span class=nv>$dir1</span> <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=s2>&#34;dir1_var1&#34;</span> &gt; <span class=si>${</span><span class=nv>dir1</span><span class=si>}</span>/var
</span></span><span class=line><span class=cl>mkdir -p <span class=nv>$dir2</span> <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=s2>&#34;dir2_var1&#34;</span> &gt; <span class=si>${</span><span class=nv>dir2</span><span class=si>}</span>/var
</span></span><span class=line><span class=cl>mkdir -p <span class=nv>$unionfs</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> <span class=nv>$parent</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># bind-propagation of unionfs dir inside &#39;podman unshare&#39; environment</span>
</span></span><span class=line><span class=cl>podman unshare mount --bind --make-shared <span class=si>${</span><span class=nv>unionfs</span><span class=si>}</span> <span class=si>${</span><span class=nv>unionfs</span><span class=si>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># run container</span>
</span></span><span class=line><span class=cl>podman run --name multienv_unionfs --privileged<span class=o>=</span><span class=nb>true</span> --rm<span class=o>=</span><span class=nb>true</span> --env <span class=nv>TZ</span><span class=o>=</span>America/Costa_Rica --env <span class=nv>PGID</span><span class=o>=</span><span class=m>1000</span> --env <span class=nv>PUID</span><span class=o>=</span><span class=m>1000</span> --env <span class=nv>UNION_DIRS</span><span class=o>=</span>/dir2<span class=o>=</span>RW:/dir1<span class=o>=</span>RO --env <span class=nv>MOUNT_PATH</span><span class=o>=</span>/unionfs/ --env <span class=nv>COW</span><span class=o>=</span><span class=nb>true</span> --volume <span class=si>${</span><span class=nv>dir2</span><span class=si>}</span>:/dir2 --volume <span class=si>${</span><span class=nv>dir1</span><span class=si>}</span>:/dir1 --volume <span class=si>${</span><span class=nv>unionfs</span><span class=si>}</span>:/unionfs:shared --detach<span class=o>=</span><span class=nb>true</span> jobcespedes/multienv
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># check that files are there inside &#39;podman unshare&#39; environment</span>
</span></span><span class=line><span class=cl>podman unshare ls -al <span class=si>${</span><span class=nv>unionfs</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=c1># check that mount point is there inside &#39;podman unshare&#39; environment</span>
</span></span><span class=line><span class=cl>podman unshare mount <span class=p>|</span> grep <span class=si>${</span><span class=nv>unionfs</span><span class=si>}</span>
</span></span></code></pre></div><h2 id=more-than-alias-dockerpodman>More than <code>alias docker=podman</code></h2><p>In retrospective, replacing docker with podman may require more than <code>alias docker=podman</code>. It required me to:</p><ul><li><strong>check <a href=https://github.com/containers/libpod>documentation</a> available</strong></li><li><strong>turn to <a href=https://github.com/containers/libpod/issues>community resources</a></strong></li><li><strong>start to really grasp concepts like <a href=https://opensource.com/article/19/2/how-does-rootless-podman-work><em>rootless</em> and <em>user namespaces</em></a></strong></li><li><strong>have fun learning new things</strong></li></ul><p>To be fair, in many cases the alias could be all you need. But in this particular one, those steps helped replacing docker with podman and extending <a href=https://github.com/jobcespedes/demo-multienv>demo-multienv</a>. Now I could run it in either one of three modes using Ansible ðŸ˜„: docker, podman or <code>unionfs</code> on the host.</p><div class=blog-tags><a href=https://jobcespedes.dev//tags/containers/>containers</a>&nbsp;
<a href=https://jobcespedes.dev//tags/podman/>podman</a>&nbsp;
<a href=https://jobcespedes.dev//tags/unionfs/>unionfs</a>&nbsp;
<a href=https://jobcespedes.dev//tags/docker/>docker</a>&nbsp;
<a href=https://jobcespedes.dev//tags/ansible/>ansible</a>&nbsp;
<a href=https://jobcespedes.dev//tags/bind-propagation/>bind-propagation</a>&nbsp;
<a href=https://jobcespedes.dev//tags/user-namespaces/>user-namespaces</a>&nbsp;
<a href=https://jobcespedes.dev//tags/genesis-126/>genesis-1:26</a>&nbsp;</div><h4 class=see-also>See also</h4><ul><li><a href=/2022/01/a-keydb-operator/>A KeyDB Operator</a></li><li><a href=/2021/07/a-kubernetes-nfs-operator/>A Kubernetes NFS Operator</a></li><li><a href=/2021/06/a-minimal-container-image-for-rocky-linux-8/>A Minimal Container Image for Rocky Linux 8</a></li><li><a href=/2020/05/simple-testing-of-complex-scenarios/>Simple Testing of Complex Scenarios</a></li><li><a href=/2020/02/multiple-environments-in-ansible/>Multiple Environments in Ansible</a></li></ul></article><ul class="pager blog-pager"><li class=previous><a href=https://jobcespedes.dev/2020/02/multiple-environments-in-ansible/ data-toggle=tooltip data-placement=top title="Multiple Environments in Ansible">&larr; Previous Post</a></li><li class=next><a href=https://jobcespedes.dev/2020/05/simple-testing-of-complex-scenarios/ data-toggle=tooltip data-placement=top title="Simple Testing of Complex Scenarios">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=https://github.com/jobcespedes title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://gitlab.com/jobcespedes title=GitLab><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-gitlab fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/jobcespedes title=LinkedIn><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted">Job CÃ©spedes Ortiz
&nbsp;&bull;&nbsp;&copy;
2023
&nbsp;&bull;&nbsp;
<a href=https://jobcespedes.dev/>My Dev Blog</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.94.1</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js integrity=sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script src=https://code.jquery.com/jquery-3.7.0.slim.min.js integrity=sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js integrity=sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd crossorigin=anonymous></script>
<script src=https://jobcespedes.dev/js/main.js></script>
<script src=https://jobcespedes.dev/js/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://jobcespedes.dev/js/load-photoswipe.js></script></body></html>